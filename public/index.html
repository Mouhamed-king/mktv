<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>MKTV Web</title>
  <meta name="theme-color" content="#071a2f" />
  <link rel="icon" type="image/svg+xml" href="/icon-192.svg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="manifest" href="/manifest.webmanifest" />
  <link rel="stylesheet" href="/styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/supabase-config.js"></script>
</head>
<body>
  <section id="authView" class="auth-view">
    <div class="auth-card">
      <div class="auth-logo-wrap">
        <img class="mktv-logo-img" src="/mktv-logo.png" alt="MKTV" onerror="this.onerror=null;this.src='/icon-512.svg';" />
      </div>
      <p class="muted">Connecte-toi pour acceder a tes chaines, favoris et historique.</p>

      <div class="auth-tabs">
        <button id="showLoginBtn" class="auth-tab active" type="button">Connexion</button>
        <button id="showSignupBtn" class="auth-tab" type="button">Inscription</button>
      </div>

      <form id="loginForm" class="auth-form">
        <label>Email</label>
        <input id="loginEmail" type="email" autocomplete="email" required />
        <label>Mot de passe</label>
        <input id="loginPassword" type="password" autocomplete="current-password" required />
        <button type="submit" class="action-btn">Se connecter</button>
      </form>

      <form id="signupForm" class="auth-form hidden">
        <label>Email</label>
        <input id="signupEmail" type="email" autocomplete="email" required />
        <label>Mot de passe</label>
        <input id="signupPassword" type="password" autocomplete="new-password" required minlength="6" />
        <button type="submit" class="action-btn">Creer un compte</button>
      </form>

      <p id="authStatus" class="muted small"></p>
    </div>
  </section>

  <div id="appView" class="app hidden">
    <aside class="sidebar">
      <div class="brand-row">
        <img class="mktv-logo-img" src="/mktv-logo.png" alt="MKTV" onerror="this.onerror=null;this.src='/icon-512.svg';" />
      </div>

      <div class="profile-card">
        <div class="avatar">
          <img class="avatar-logo" src="/mktv-logo.png" alt="MKTV" onerror="this.onerror=null;this.src='/icon-512.svg';" />
        </div>
        <div class="profile-meta">
          <p id="userEmail" class="email">mktv@local</p>
          <p class="trial">Compte actif</p>
        </div>
      </div>

      <button id="toggleMainTabsBtn" class="accordion-toggle" type="button">Menus</button>
        <div id="mainTabsPanel" class="accordion-panel is-open">
          <div class="main-tabs">
          <button class="main-tab active" data-tab="live" type="button" aria-label="Live" title="Live">
            <span class="tab-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" focusable="false">
                <path d="M3 11.2L12 4l9 7.2v8.3a1.5 1.5 0 0 1-1.5 1.5H15v-6h-6v6H4.5A1.5 1.5 0 0 1 3 19.5z"></path>
              </svg>
            </span>
            <span class="tab-label">Live</span>
          </button>
          <button class="main-tab" data-tab="favorites" type="button" aria-label="Favoris" title="Favoris">
            <span class="tab-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" focusable="false">
                <path d="M12 20.7l-1.1-1C6 15.3 3 12.6 3 9.3A4.3 4.3 0 0 1 7.3 5c1.8 0 3.4.9 4.4 2.3A5.4 5.4 0 0 1 16.1 5 4.3 4.3 0 0 1 20.4 9.3c0 3.3-3 6-7.9 10.4z"></path>
              </svg>
            </span>
            <span class="tab-label">Favoris</span>
          </button>
          <button class="main-tab" data-tab="recent" type="button" aria-label="Recent" title="Recent">
            <span class="tab-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" focusable="false">
                <path d="M12 3a9 9 0 1 0 8.6 11.7h-2.1A7 7 0 1 1 12 5V2.8l4 3.2-4 3.2V7a5 5 0 1 0 4.8 6.6h-2.2A3 3 0 1 1 12 9z"></path>
              </svg>
            </span>
            <span class="tab-label">Recent</span>
          </button>
          <button class="main-tab" data-tab="settings" type="button" aria-label="Parametres" title="Parametres">
            <span class="tab-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" focusable="false">
                <path d="M19.4 13a7.8 7.8 0 0 0 .1-2l2-1.5-2-3.5-2.4 1a8.1 8.1 0 0 0-1.7-1l-.4-2.6h-4l-.4 2.6a8.1 8.1 0 0 0-1.7 1l-2.4-1-2 3.5 2 1.5a7.8 7.8 0 0 0 0 2l-2 1.5 2 3.5 2.4-1a8.1 8.1 0 0 0 1.7 1l.4 2.6h4l.4-2.6a8.1 8.1 0 0 0 1.7-1l2.4 1 2-3.5zM12 15.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7z"></path>
              </svg>
            </span>
            <span class="tab-label">Parametres</span>
          </button>
          </div>
        </div>

      <button id="toggleGroupsBtn" class="accordion-toggle" type="button">Categories</button>
      <div id="groupsBlock" class="accordion-panel is-open">
        <div class="sidebar-head">
          <span>Categories</span>
        </div>
        <nav id="groupNav" class="group-nav">
          <button class="group-item active" type="button" data-group="">
            <span>Toutes</span>
            <span class="count">0</span>
          </button>
        </nav>
      </div>

      <label class="sr-only" for="groupSelect">Categorie</label>
      <select id="groupSelect" class="sr-only" aria-hidden="true" tabindex="-1">
        <option value="">Toutes</option>
      </select>
    </aside>

    <main class="main">
      <header class="topbar">
        <div class="title-wrap">
          <img class="topbar-logo" src="/mktv-logo.png" alt="MKTV" onerror="this.onerror=null;this.src='/icon-512.svg';" />
          <h2 id="pageTitle">Live</h2>
          <p class="muted small" id="listMeta">Chargement...</p>
        </div>
        <div class="topbar-right">
          <label class="search-wrap" for="searchInput">
            <span class="sr-only">Recherche</span>
            <input id="searchInput" type="search" placeholder="Rechercher une chaine..." />
          </label>
          <button id="installAppBtn" class="install-btn hidden" type="button" title="Installer l'application">
            Télécharger l'app
          </button>
        </div>
      </header>

      <section id="liveSection" class="section-panel">
        <div class="player-shell is-hidden">
        <div class="player-head">
          <h3 id="currentTitle">Selectionnez une chaine</h3>
          <div class="player-meta">
            <p id="playerStatus" class="muted small"></p>
            <button id="playerFullscreenBtn" class="player-fullscreen-btn" type="button">Plein ecran</button>
          </div>
        </div>
          <video id="player" controls autoplay playsinline></video>
          <div id="playerLoading" class="player-loading hidden" aria-live="polite">
            <div class="player-loading-brand" aria-hidden="true">
              <img class="player-loading-logo" src="/mktv-logo.png" alt="" onerror="this.onerror=null;this.src='/icon-512.svg';" />
            </div>
            <div class="player-loading-skeleton" aria-hidden="true">
              <div class="skeleton-line line-lg"></div>
              <div class="skeleton-line line-md"></div>
              <div class="skeleton-line line-sm"></div>
            </div>
            <p>Connexion au direct...</p>
          </div>
        </div>

        <div class="channels-shell">
          <div id="channelsList" class="channels-grid"></div>
          <button id="loadMoreBtn" class="load-btn" type="button">Charger plus</button>
        </div>
      </section>

      <section id="favoritesSection" class="section-panel hidden">
        <div id="favoritesList" class="channels-grid"></div>
      </section>

      <section id="recentSection" class="section-panel hidden">
        <div id="recentList" class="channels-grid"></div>
      </section>

      <section id="settingsSection" class="section-panel hidden">
        <div class="settings-card">
          <h3>Parametres</h3>
          <p class="muted">Etat Supabase: <strong id="supabaseStatus">Non configure</strong></p>
          <p class="muted">Utilisateur: <strong id="settingsUserEmail">-</strong></p>
          <button id="logoutBtn" class="action-btn danger" type="button">Se deconnecter</button>
        </div>
      </section>
    </main>
  </div>

  <script src="/app.js"></script>
</body>
</html>
